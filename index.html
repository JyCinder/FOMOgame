<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/web3@0.19.0/dist/web3.js"></script>
	<script type="text/javascript">
		var FOMOgame
		function onload() {
			if (typeof web3 !== 'undefined') {
				window.web3 = new Web3(web3.currentProvider);
				console.log("Connected to Metamask")
			} else {
				console.log('No web3? You should consider trying Metamask!')
			}
			var FOMOgameContract = web3.eth.contract([{"constant": true,"inputs": [],"name": "lastAKeyPrice","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [{"name": "_rid","type": "uint256"}],"name": "claimRewards","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": false,"inputs": [{"name": "_rid","type": "uint256"}],"name": "withdrawDividends","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [{"name": "","type": "address"}],"name": "addrToPID","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "isCurrRoundEnded","outputs": [{"name": "","type": "bool"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "lastPID","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [],"name": "withdraw","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [{"name": "_quantity","type": "uint256"}],"name": "BKeysOf","outputs": [{"name": "","type": "uint256"},{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "lastBKeyPrice","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [],"name": "startRound","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "currRID","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [],"name": "renounceOwnership","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": false,"inputs": [],"name": "endRound","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "increaseStep","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "launchTime","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "roundInterval","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "initAKeyPrice","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "keyDecimal","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [{"name": "","type": "uint256"}],"name": "rounds","outputs": [{"name": "RID","type": "uint256"},{"name": "totalAKeys","type": "uint256"},{"name": "totalBKeys","type": "uint256"},{"name": "pot","type": "uint256"},{"name": "dividends","type": "uint256"},{"name": "foundationReserved","type": "uint256"},{"name": "lastPlayerReward","type": "uint256"},{"name": "lastPlayer","type": "address"},{"name": "start","type": "uint256"},{"name": "end","type": "uint256"},{"name": "hasBeenEnded","type": "bool"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "BRewardPercent","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "owner","outputs": [{"name": "","type": "address"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [{"name": "_account","type": "address"},{"name": "_amount","type": "uint256"}],"name": "updateAndRecalc","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "ARewardPercent","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [],"name": "withdrawLeftover","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": false,"inputs": [{"name": "_account","type": "address"},{"name": "_amount","type": "uint256"},{"name": "_aKeys","type": "uint256"},{"name": "_bKeys","type": "uint256"}],"name": "roundUpdate","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [{"name": "","type": "uint256"},{"name": "","type": "uint256"}],"name": "playerRounds","outputs": [{"name": "PID","type": "uint256"},{"name": "RID","type": "uint256"},{"name": "AKeys","type": "uint256"},{"name": "BKeys","type": "uint256"},{"name": "lastAKeys","type": "uint256"},{"name": "claimedAEarning","type": "uint256"},{"name": "initTotalDivi","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [{"name": "_quantity","type": "uint256"}],"name": "AKeysOf","outputs": [{"name": "","type": "uint256"},{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [{"name": "sender","type": "address"},{"name": "value","type": "uint256"}],"name": "dealWithPay","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "countdown","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [],"name": "checkAndPayLastPlayer","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "reservedPercent","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "expirationTime","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": false,"inputs": [{"name": "_newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [],"name": "lastPlayerPercent","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [{"name": "","type": "uint256"}],"name": "PIDToPlayers","outputs": [{"name": "PID","type": "uint256"},{"name": "account","type": "address"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "initBKeyPrice","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"inputs": [],"payable": false,"stateMutability": "nonpayable","type": "constructor"},{"payable": true,"stateMutability": "payable","type": "fallback"},{"anonymous": false,"inputs": [{"indexed": false,"name": "player","type": "address"},{"indexed": false,"name": "amount","type": "uint256"}],"name": "DividendsIncr","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "player","type": "address"},{"indexed": false,"name": "amount","type": "uint256"}],"name": "DividendsPaid","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "amount","type": "uint256"}],"name": "NewDividends","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "last","type": "address"}],"name": "GetLastWinner","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "amount","type": "uint256"}],"name": "PotIncr","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "roundID","type": "uint256"},{"indexed": false,"name": "startTime","type": "uint256"},{"indexed": false,"name": "endTime","type": "uint256"}],"name": "NewRound","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "newEnd","type": "uint256"}],"name": "EndUpdate","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "sender","type": "address"},{"indexed": false,"name": "value","type": "uint256"}],"name": "PaymentReceived","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "player","type": "address"},{"indexed": false,"name": "rewards","type": "uint256"}],"name": "RewardsClear","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"name": "previousOwner","type": "address"}],"name": "OwnershipRenounced","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"name": "previousOwner","type": "address"},{"indexed": true,"name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"}]);

			FOMOgame = FOMOgameContract.at('0xcc6983856f25a988130f9f703a5c3658fab3164b');
			console.log(FOMOgame);
		}
		window.addEventListener('load', onload);
	</script>
</head>

<script>
	function curRoundInfo() {
		var ROUNDID = document.getElementById("roundID").value;
		var PLAYERID = document.getElementById("playerID").value;
		var ROUNDINFO
		var PLAYERINFO
		var curAKeyPrice
		var curBKeyPrice
		var countDown
		FOMOgame.rounds.call(ROUNDID,function(error,result) {
			if (!error) {
				ROUNDINFO=result
			} else {
				console.log(error)
			}
		});
				//console.log(ROUNDINFO);
		FOMOgame.playerRounds.call(ROUNDID,PLAYERID,function(error,result) {
			if (!error) {
				PLAYERINFO=result
			} else {
				console.log(error)
			}
		});
		FOMOgame.lastAKeyPrice.call(function(error,result) {
			if (!error) {
				curAKeyPrice=result
			} else {
				console.log(error)
			}
		});
		FOMOgame.lastBKeyPrice.call(function(error,result) {
			if (!error) {
				curBKeyPrice=result
			} else {
				console.log(error)
			}
		});
		FOMOgame.countdown.call(function(error,result) {
			if (!error) {
				countDown=result
			} else {
				console.log(error)
			}
		});
		var hoursLeft = Math.floor(Math.floor(countDown/60)/60)
		var minsLeft = Math.floor(Math.floor(countDown/60)) - hoursLeft*60
		var secsLeft = countDown % 60
		document.getElementById("roundInfoDisplay").innerText = "Last player at address " + ROUNDINFO[7] + " gets " + ROUNDINFO[6] + " rewards" +"\n" + "Current price of an A key: " + curAKeyPrice + ", you have " + ROUNDINFO[1] + " A keys" + "\n" + "Current price of a B key: " + curBKeyPrice + ", you have " + ROUNDINFO[2] + " B keys" + "\n" + "Your current earnings: " + PLAYERINFO[5] + "\n" + "Current round ends in " + hoursLeft + " hours, " + minsLeft + " minutes, and " + secsLeft + " seconds";
	}
	function roundSelection() {
		var curRound = FOMOgame.currRID.call();
		document.getElementById("warningDisplay").innerText = "Choose an integer between 1 and " + curRound + " to get your dividends from that round";
		var roundChosen = document.getElementById("selectRound").value;
		FOMOgame.withdrawDividends.sendTransaction(roundChosen,{from:"0x7ba1500c66f482104bc4f08accac55c1e0c5701b"});
				//var playeraddress = document.getElementById("playerAddress").value;
				//var ethAmount = .1
				//from here the metamask should pop up
	}      

	function closedRoundSelection() {
		var curRound = FOMOgame.currRID.call();
		if (curRound == 1) {
			document.getElementById("closedWarningDisplay").innerText = "No rewards to claim";
		} else {
			document.getElementById("closedWarningDisplay").innerText = "Choose an integer between 1 and " + (curRound-1) + " to get your rewards from closed rounds";
			var closedRoundChosen = document.getElementById("selectClosedRound").value;
			FOMOgame.claimRewards.sendTransaction(closedRoundChosen);
		}
	}
		//var subscription = web3js.eth.subscribe(function(error,result){
			//if (!error) {
				//document.getElementById("newRoundDisplay").innerText = "Round "+ subscription.args.roundID + " has started!";
			//} else {
				//console.log(error);
			//}
		//});

		//subscription.unsubscribe(function(error, success){
    		//if(success)
        		//console.log('Successfully unsubscribed!');
		//});

		//FOMOgame.NewRound().watch(function(error, result){
			//if (!error) {
				//document.getElementById("newRoundDisplay").innerText = "Round "+ result.args.roundID + " has started!";
			//} else {
				//console.log(error);
			//}
		//});

		//var newRoundEvent = FOMOgame.NewRound();
		//newRoundEvent.watch(function(error, result) {
			//if (!error) {
				//document.getElementById("newRoundDisplay").innerText = "Round "+ result.args.roundID + " has started!";
			//} else {
				//console.log(error);
			//}
		//});
			//roundInfoResult = FOMOgame.rounds(1,function(err, result){console.log(result)});
			//console.log(roundInfoResult)
			//if (($("#roundID").val() != null) & ($("#playerID").val() != null)) { 
				//var roundInfoResult = FOMOgame.rounds($("#roundID").val());
			//}
			//$("#button").click(function() {
				//$("#roundInfoDisplay").html("blablabla");
				
			//});
</script>
<body>
		<h1>FOMO</h1>
		<label for="roundInfo" class="col-lg-2 control-label">Round ID</label>
		<input id="roundID" type="number">

		<label for="roundInfo" class="col-lg-2 control-label">Player ID</label>
		<input id="playerID" type="number">
		<button type = "button" onClick = "curRoundInfo();">Get Round Info</button>
		<div id="roundInfoDisplay"></div>
		<div id="newRoundDisplay"></div>
		<img src="qrcode.png" alt="QR code for the contract address">
		<p>Scan the QR code to send tokens to the contract address</p>
		<label for="selectRound" class="col-lg-2 control-label">Select a round</label>
		<input id="selectRound" type="number">
		<button type = "button" onClick = "roundSelection();">Get dividends</button>
		<div id="warningDisplay"></div>

		<label for="selectClosedRound" class="col-lg-2 control-label">Select a closed round</label>
		<input for="selectClosedRound" type="number">
		<button type = "button" onClick = "closedRoundSelection();">Get rewards</button>
		<div id="closedWarningDisplay"></div>
</body>
</html>







