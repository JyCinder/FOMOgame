<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/web3@0.19.0/dist/web3.js"></script>
	<script type="text/javascript">
		var FOMOgame
		function onload() {
			if (typeof web3 !== 'undefined') {
				window.web3 = new Web3(web3.currentProvider);
				console.log("Connected to Metamask")
			} else {
				console.log('No web3? You should consider trying Metamask!')
			}
			var FOMOgameContract = web3.eth.contract([{"anonymous": false,"inputs": [{"indexed": true,"name": "previousOwner","type": "address"},{"indexed": true,"name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"},{"constant": false,"inputs": [{"name": "_rid","type": "uint256"}],"name": "claimRewards","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"anonymous": false,"inputs": [{"indexed": false,"name": "amount","type": "uint256"}],"name": "NewDividends","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "last","type": "address"}],"name": "GetLastWinner","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"name": "previousOwner","type": "address"}],"name": "OwnershipRenounced","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "player","type": "address"},{"indexed": false,"name": "amount","type": "uint256"}],"name": "DividendsIncr","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "player","type": "address"},{"indexed": false,"name": "rewards","type": "uint256"}],"name": "RewardsClear","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "amount","type": "uint256"}],"name": "PotIncr","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "newEnd","type": "uint256"}],"name": "EndUpdate","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "sender","type": "address"},{"indexed": false,"name": "value","type": "uint256"}],"name": "PaymentReceived","type": "event"},{"anonymous": false,"inputs": [{"indexed": false,"name": "player","type": "address"},{"indexed": false,"name": "amount","type": "uint256"}],"name": "DividendsPaid","type": "event"},{"constant": false,"inputs": [],"name": "endRound","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"anonymous": false,"inputs": [{"indexed": false,"name": "roundID","type": "uint256"},{"indexed": false,"name": "startTime","type": "uint256"},{"indexed": false,"name": "endTime","type": "uint256"}],"name": "NewRound","type": "event"},{"constant": false,"inputs": [],"name": "renounceOwnership","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": false,"inputs": [],"name": "startRound","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": false,"inputs": [{"name": "_newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"payable": true,"stateMutability": "payable","type": "fallback"},{"inputs": [],"payable": false,"stateMutability": "nonpayable","type": "constructor"},{"constant": false,"inputs": [{"name": "_rid","type": "uint256"}],"name": "withdraw","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": false,"inputs": [{"name": "_rid","type": "uint256"}],"name": "withdrawDividends","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": false,"inputs": [],"name": "withdrawLeftover","outputs": [],"payable": false,"stateMutability": "nonpayable","type": "function"},{"constant": true,"inputs": [{"name": "","type": "address"}],"name": "addrToPID","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [{"name": "_quantity","type": "uint256"}],"name": "AKeysOf","outputs": [{"name": "","type": "uint256"},{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "ARewardPercent","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [{"name": "_quantity","type": "uint256"}],"name": "BKeysOf","outputs": [{"name": "","type": "uint256"},{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{"constant": true,"inputs": [],"name": "BRewardPercent","outputs": [{"name": "","type": "uint256"}],"payable": false,"stateMutability": "view","type": "function"},{
		"constant": true,
		"inputs": [],
		"name": "countdown",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "currRID",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "expirationTime",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "initAKeyPrice",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "initBKeyPrice",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "isCurrRoundEnded",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "keyDecimal",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "lastAKeyPrice",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "lastBKeyPrice",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "lastPID",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "lastPlayerPercent",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "launchTime",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "PIDToPlayers",
		"outputs": [
			{
				"name": "account",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "playerRounds",
		"outputs": [
			{
				"name": "AKeys",
				"type": "uint256"
			},
			{
				"name": "BKeys",
				"type": "uint256"
			},
			{
				"name": "lastAKeys",
				"type": "uint256"
			},
			{
				"name": "maxTxID",
				"type": "uint256"
			},
			{
				"name": "startClaimTxID",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "reservedPercent",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "roundInterval",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "rounds",
		"outputs": [
			{
				"name": "totalAKeys",
				"type": "uint256"
			},
			{
				"name": "totalBKeys",
				"type": "uint256"
			},
			{
				"name": "pot",
				"type": "uint256"
			},
			{
				"name": "dividends",
				"type": "uint256"
			},
			{
				"name": "foundationReserved",
				"type": "uint256"
			},
			{
				"name": "lastPlayerReward",
				"type": "uint256"
			},
			{
				"name": "lastPlayer",
				"type": "address"
			},
			{
				"name": "start",
				"type": "uint256"
			},
			{
				"name": "end",
				"type": "uint256"
			},
			{
				"name": "hasBeenEnded",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
])

			FOMOgame = FOMOgameContract.at('0xdffd08cf34017c3ff78e1b6146b0b56e005fa64d');
			console.log(FOMOgame);
		}
		window.addEventListener('load', onload);
	</script>
</head>

<script>
	function curRoundInfo() {
		var ROUNDID = document.getElementById("roundID").value;
		var PLAYERID = document.getElementById("playerID").value;
		FOMOgame.rounds.call(ROUNDID,function(error,result) {
			if (!error) {
				document.getElementById("lastPlayerAddress").innerText = result[6]
				document.getElementById("lastPlayerReward").innerText = result[5]
				document.getElementById("AKeyNum").innerText = result[0]
				document.getElementById("BKeyNum").innerText = result[1]
				document.getElementById("currentEarning").innerText = result[3]
				//ROUNDINFO=result
			} else {
				console.log(error)
			}
		});
				//console.log(ROUNDINFO);
		//FOMOgame.playerRounds.call(ROUNDID,PLAYERID,function(error,result) {
			//if (!error) {
				//document.getElementById("currentEarning").innerText = result[5]
				//PLAYERINFO=result
			//} else {
				//console.log(error)
			//}
		//});

		FOMOgame.lastAKeyPrice.call(function(error,result) {
			if (!error) {
				document.getElementById("currentAKeyPrice").innerText = result
				//curAKeyPrice=result
			} else {
				console.log(error)
			}
		});

		FOMOgame.lastBKeyPrice.call(function(error,result) {
			if (!error) {
				document.getElementById("currentBKeyPrice").innerText = result
				//curBKeyPrice=result
			} else {
				console.log(error)
			}
		});
		FOMOgame.countdown.call(function(error,result) {
			if (!error) {
				document.getElementById("hours").innerText = Math.floor(Math.floor(result/60)/60)
				document.getElementById("minutes").innerText = Math.floor(Math.floor(result/60)) - Math.floor(Math.floor(result/60)/60)*60
				document.getElementById("seconds").innerText = result % 60
				//countDown=result
			} else {
				console.log(error)
			}
		});
		//var hoursLeft = Math.floor(Math.floor(countDown/60)/60)
		//var minsLeft = Math.floor(Math.floor(countDown/60)) - hoursLeft*60
		//var secsLeft = countDown % 60
		//console.log(ROUNDINFO,PLAYERINFO,curAKeyPrice,curBKeyPrice,countDown)
		//document.getElementById("roundInfoDisplay").innerText = "Last player at address " + ROUNDINFO[7] + " gets " + ROUNDINFO[6] + " rewards" +"\n" + "Current price of an A key: " + curAKeyPrice + ", you have " + ROUNDINFO[1] + " A keys" + "\n" + "Current price of a B key: " + curBKeyPrice + ", you have " + ROUNDINFO[2] + " B keys" + "\n" + "Your current earnings: " + PLAYERINFO[5] + "\n" + "Current round ends in " + hoursLeft + " hours, " + minsLeft + " minutes, and " + secsLeft + " seconds";
	}
	function roundSelection() {
		FOMOgame.currRID.call(function(error,result) {
			if (!error) {
				document.getElementById("availableRounds").innerText = result
			}
		})
		var roundChosen = document.getElementById("selectRound").value;
		FOMOgame.withdrawDividends.sendTransaction(roundChosen,{from:"0x7ba1500c66f482104bc4f08accac55c1e0c5701b"}, function(error,result) {
			if (!error) {
				console.log("no error")
			} else {
				console.log(error)
			}
		});
				//var playeraddress = document.getElementById("playerAddress").value;
				//var ethAmount = .1
				//from here the metamask should pop up
	}      

	function closedRoundSelection() {
		var closedRoundChosen = document.getElementById("selectClosedRound").value;
		FOMOgame.claimRewards.sendTransaction(closedRoundChosen, {from:"0x7ba1500c66f482104bc4f08accac55c1e0c5701b"}, function(error,result) {
			if (!error) {
				console.log("no error")
			} else {
				console.log(error)
			}
		});
		}

	FOMOgame.NewRound().watch((error,response) {
		if (!error) {
			document.getElementById("newround").innerText = "A new round has started"
		} else {
			console.log(error)
		}
	})
		//var subscription = web3js.eth.subscribe(function(error,result){
			//if (!error) {
				//document.getElementById("newRoundDisplay").innerText = "Round "+ subscription.args.roundID + " has started!";
			//} else {
				//console.log(error);
			//}
		//});

		//subscription.unsubscribe(function(error, success){
    		//if(success)
        		//console.log('Successfully unsubscribed!');
		//});

		//FOMOgame.NewRound().watch(function(error, result){
			//if (!error) {
				//document.getElementById("newRoundDisplay").innerText = "Round "+ result.args.roundID + " has started!";
			//} else {
				//console.log(error);
			//}
		//});

		//var newRoundEvent = FOMOgame.NewRound();
		//newRoundEvent.watch(function(error, result) {
			//if (!error) {
				//document.getElementById("newRoundDisplay").innerText = "Round "+ result.args.roundID + " has started!";
			//} else {
				//console.log(error);
			//}
		//});
			//roundInfoResult = FOMOgame.rounds(1,function(err, result){console.log(result)});
			//console.log(roundInfoResult)
			//if (($("#roundID").val() != null) & ($("#playerID").val() != null)) { 
				//var roundInfoResult = FOMOgame.rounds($("#roundID").val());
			//}
			//$("#button").click(function() {
				//$("#roundInfoDisplay").html("blablabla");
				
			//});
</script>
<body>
		<h1>FOMO</h1>
		<h2><span id="newround"></span></h2>
		<label for="roundInfo" class="col-lg-2 control-label">Round ID</label>
		<input id="roundID" type="number">

		<label for="roundInfo" class="col-lg-2 control-label">Player ID</label>
		<input id="playerID" type="number">
		<button type = "button" onClick = "curRoundInfo();">Get Round Info</button>
		<p>Last player at address <span id="lastPlayerAddress"></span> gets <span id="lastPlayerReward"></span> rewards</p>
		<p>Current price of an A key: <span id="currentAKeyPrice"></span>, you have <span id="AKeyNum"></span> A keys</p>
		<p>Current price of a B key: <span id="currentBKeyPrice"></span>, you have <span id="BKeyNum"></span> B keys</p>
		<p>Your current earnings: <span id="currentEarning"></span>
		<p>Current round ends in <span id="hours"></span> hours, <span id="minutes"></span> minutes, and <span id="seconds"></span> seconds</p>
		<div id="newRoundDisplay"></div>
		<img src="qrcode.png" alt="QR code for the contract address">
		<p>Scan the QR code to send tokens to the contract address</p>
		<p>Choose an integer between 1 and <span id="availableRounds"></span> to get your dividends from that round</p>
		<label for="selectRound" class="col-lg-2 control-label">Select a round</label>
		<input id="selectRound" type="number">
		<button type = "button" onClick = "roundSelection();">Get dividends</button>

		<label for="selectClosedRound" class="col-lg-2 control-label">Select a closed round</label>
		<input for="selectClosedRound" type="number">
		<button type = "button" onClick = "closedRoundSelection();">Get rewards</button>
</body>
</html>

